{"ast":null,"code":"import _objectSpread from\"C:/Users/sunil/OneDrive/Desktop/book-review-platform-deploy-ready/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import api from'../api/api';import{useParams,Link}from'react-router-dom';import{BarChart,Bar,XAxis,YAxis,Tooltip,ResponsiveContainer}from'recharts';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function BookDetails(){var _data$avgRating;const{id}=useParams();const[data,setData]=useState(null);const[dist,setDist]=useState(null);const[review,setReview]=useState({rating:5,reviewText:''});const user=JSON.parse(localStorage.getItem('user')||'null');const fetchDetails=async()=>{try{const res=await api.get(\"/books/\".concat(id));setData(res.data);}catch(err){console.error(err);}};const fetchDistribution=async()=>{try{const res=await api.get(\"/books/\".concat(id,\"/ratings/distribution\"));setDist(res.data.distribution);}catch(err){console.error(err);}};useEffect(()=>{fetchDetails();fetchDistribution();},[id]);const submitReview=async()=>{try{await api.post(\"/reviews/\".concat(id),review);setReview({rating:5,reviewText:''});fetchDetails();fetchDistribution();}catch(err){var _err$response,_err$response$data;alert(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Error adding review');}};if(!data)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});const chartData=dist?[5,4,3,2,1].map(k=>({rating:k,count:dist[String(k)]||0})):[];return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:data.book.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"small\",children:[\"By \",data.book.author]}),/*#__PURE__*/_jsx(\"p\",{children:data.book.description}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Average Rating: \",(_data$avgRating=data.avgRating)!==null&&_data$avgRating!==void 0?_data$avgRating:'N/A',\" (\",data.reviewsCount,\")\"]}),user&&String(user._id)===String(data.book.addedBy)&&/*#__PURE__*/_jsx(Link,{to:\"/edit/\".concat(data.book._id),children:\"Edit Book\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Reviews\"}),data.reviews.length===0&&/*#__PURE__*/_jsx(\"p\",{children:\"No reviews yet\"}),data.reviews.map(r=>/*#__PURE__*/_jsxs(\"div\",{className:\"card\",style:{marginBottom:8},children:[/*#__PURE__*/_jsx(\"strong\",{children:r.userId.name}),\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"small\",children:[\"\\u2022 \",r.rating,\" \\u2B50\"]}),/*#__PURE__*/_jsx(\"p\",{children:r.reviewText})]},r._id))]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:12},className:\"card\",children:user?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Add / Update Review\"}),/*#__PURE__*/_jsx(\"select\",{value:review.rating,onChange:e=>setReview(_objectSpread(_objectSpread({},review),{},{rating:Number(e.target.value)})),children:[5,4,3,2,1].map(n=>/*#__PURE__*/_jsxs(\"option\",{value:n,children:[n,\" stars\"]},n))}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Your review\",value:review.reviewText,onChange:e=>setReview(_objectSpread(_objectSpread({},review),{},{reviewText:e.target.value}))}),/*#__PURE__*/_jsx(\"button\",{onClick:submitReview,children:\"Submit Review\"})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Please login to add a review.\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12},className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Rating Distribution\"}),chartData.length>0?/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:200,children:/*#__PURE__*/_jsxs(BarChart,{data:chartData,children:[/*#__PURE__*/_jsx(XAxis,{dataKey:\"rating\"}),/*#__PURE__*/_jsx(YAxis,{allowDecimals:false}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"count\"})]})}):/*#__PURE__*/_jsx(\"p\",{className:\"small\",children:\"No rating distribution yet.\"})]})]});}","map":{"version":3,"names":["React","useEffect","useState","api","useParams","Link","BarChart","Bar","XAxis","YAxis","Tooltip","ResponsiveContainer","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","BookDetails","_data$avgRating","id","data","setData","dist","setDist","review","setReview","rating","reviewText","user","JSON","parse","localStorage","getItem","fetchDetails","res","get","concat","err","console","error","fetchDistribution","distribution","submitReview","post","_err$response","_err$response$data","alert","response","message","children","chartData","map","k","count","String","className","book","title","author","description","avgRating","reviewsCount","_id","addedBy","to","style","marginTop","reviews","length","r","marginBottom","userId","name","value","onChange","e","_objectSpread","Number","target","n","placeholder","onClick","width","height","dataKey","allowDecimals"],"sources":["C:/Users/sunil/OneDrive/Desktop/book-review-platform-deploy-ready/frontend/src/pages/BookDetails.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport api from '../api/api';\nimport { useParams, Link } from 'react-router-dom';\nimport { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer } from 'recharts';\n\nexport default function BookDetails(){\n  const { id } = useParams();\n  const [data, setData] = useState(null);\n  const [dist, setDist] = useState(null);\n  const [review, setReview] = useState({ rating:5, reviewText: '' });\n  const user = JSON.parse(localStorage.getItem('user') || 'null');\n\n  const fetchDetails = async () => {\n    try {\n      const res = await api.get(`/books/${id}`);\n      setData(res.data);\n    } catch (err) { console.error(err); }\n  };\n  const fetchDistribution = async () => {\n    try {\n      const res = await api.get(`/books/${id}/ratings/distribution`);\n      setDist(res.data.distribution);\n    } catch (err) { console.error(err); }\n  };\n  useEffect(()=>{ fetchDetails(); fetchDistribution(); }, [id]);\n\n  const submitReview = async () => {\n    try {\n      await api.post(`/reviews/${id}`, review);\n      setReview({ rating:5, reviewText:'' });\n      fetchDetails(); fetchDistribution();\n    } catch (err) {\n      alert(err.response?.data?.message || 'Error adding review');\n    }\n  };\n\n  if (!data) return <div>Loading...</div>;\n  const chartData = dist ? [5,4,3,2,1].map(k => ({ rating: k, count: dist[String(k)] || 0 })) : [];\n  return (\n    <div>\n      <div className=\"card\">\n        <h2>{data.book.title}</h2>\n        <p className=\"small\">By {data.book.author}</p>\n        <p>{data.book.description}</p>\n        <p>Average Rating: {data.avgRating ?? 'N/A'} ({data.reviewsCount})</p>\n        {user && String(user._id) === String(data.book.addedBy) && <Link to={`/edit/${data.book._id}`}>Edit Book</Link>}\n      </div>\n\n      <div style={{marginTop:12}}>\n        <h3>Reviews</h3>\n        {data.reviews.length === 0 && <p>No reviews yet</p>}\n        {data.reviews.map(r=>(\n          <div key={r._id} className=\"card\" style={{marginBottom:8}}>\n            <strong>{r.userId.name}</strong> <span className=\"small\">• {r.rating} ⭐</span>\n            <p>{r.reviewText}</p>\n          </div>\n        ))}\n      </div>\n\n      <div style={{marginTop:12}} className=\"card\">\n        {user ? (\n          <>\n            <h4>Add / Update Review</h4>\n            <select value={review.rating} onChange={e=>setReview({...review, rating: Number(e.target.value)})}>\n              {[5,4,3,2,1].map(n=> <option key={n} value={n}>{n} stars</option>)}\n            </select>\n            <textarea placeholder=\"Your review\" value={review.reviewText} onChange={e=>setReview({...review, reviewText: e.target.value})} />\n            <button onClick={submitReview}>Submit Review</button>\n          </>\n        ) : <p>Please login to add a review.</p>}\n      </div>\n\n      <div style={{marginTop:12}} className=\"card\">\n        <h3>Rating Distribution</h3>\n        {chartData.length > 0 ? (\n          <ResponsiveContainer width=\"100%\" height={200}>\n            <BarChart data={chartData}>\n              <XAxis dataKey=\"rating\" />\n              <YAxis allowDecimals={false} />\n              <Tooltip />\n              <Bar dataKey=\"count\" />\n            </BarChart>\n          </ResponsiveContainer>\n        ) : <p className=\"small\">No rating distribution yet.</p>}\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}